# 상위 계층(세션 계층 + 표현 계층 + 응용 계층)
## 1. 상위 계층의 이해
- 상위 계층인 세션 계층, 표현 계층, 응용 계층은 하나의 프로그램으로 묶여 사용자 프로그램으로 구현된다. 
  - 세션 계층, 표현 계층의 기능은 단순화되거나 구현되지 않는 경우가 많다.
- 상위 계층은 응용 환경의 요구조건에 따라 복잡도가 달라진다.
 
## 2. 세션 계층
- 응용 환경에서 두 응용프로세스 간의 세션을 설정하기 위해 만들며, 상위 계층에 제공하는 기능은 아래와 같다.
  - 세션 연결의 설정과 해제
  - 세션 메세지 전송
  - 동기(Synchronization) 문제를 처리

### 세션 계층 vs 전송 계층
- 다운로드 과정에서 TCP 연결이 끊겨 전송이 중단되었다고 가정해보자.
  - 세션 기능이 없으면 : 서버와 다시 연결해 처음부터 다운로드 작업을 실행해야 한다.
  - 세션 기능이 있으면 : 복구 후 이미 다운로드된 내용 이후부터 연속해서 전송받을 수 있다.

### 동기(Synchronization) 문제 처리
- 동기 기능 : 통신 양단에서 서로 동의하는 논리적인 공통 처리 지점(동기점)을 정하기 위해 사용되는데, 동기점의 설정은 메세지 전송과정 시 발생하는 오류를 복구하기 위해서이다.
  - 동기점이 설정된 지점까지는 모두 완벽하게 처리되었으니, 오류 발생 시 동기점 이후부터 작업
- 세션 연결을 사용한 메세지 전송과정인 대화 단계에서 오류가 발생하면 이전에 설정된 동기점까지는 복구할 수 있다.

### 토큰
- 두 응용 프로세스의 대화를 관리하기 위해 만든 특수 메세지로 세션 계층에서 사용.

#### 토큰의 종류
- 데이터 토큰(Data Token) : 데이터를 전송할 수 있는 권리를 제공. 데이터 전송시 세션 사용자는 반드시 데이터 토튼을 가져야함
- 해제 토큰(Release Token) : 통신 양단 간의 연결 해제과정을 제어하기위해 사용. 임의의 사용자가 연결해제요청하려면 필요
- 동기 토큰(Synchronization Token) : 세션 연결을 사용하는 과정에서 동기 처리가 필요한 지점에 사용

#### 동기점을 부여하기 위한 토큰
- 큰 파일을 전송할 때 한번에 하나를 보내는 것보다 작은 단위로 나누어 보내는 것이 전송 오류에 대처하기 쉽다.
  - 작은 단위로 나누어 전송 후 에러가 발생한다면, 위에서 언급된 동기점을 이용해 완료 이후의 데이터만 추가로 전송해주면 된다.
- 동기점을 부여하기 위해 동기 토큰을 사용하며 크게 2가지 종류가 있다.
```
주동기 토큰 / 액티비티 토큰(Major Token) : 특정 대화 단위를 구분한다
부동기 토큰(Minor Token) : 대화 단위 내에서 다시 작은 단위로 나누어 처리
```

### 동기
- 세션 연결을 사용해 데이터를 주고 받다 오류가 발생했을 때, 이를 효과적으로 복구할 수 있게 해준다.

#### 재동기 기능
- 전송 오류 발생 시 해당 지점(동기점)으로 돌아가 복구하는 일련의 복구과정
<p align="center"><img src="../images/synchronization_point.jpg" width="700"></p>

- 위의 그림처럼 동기점은 주동기점과 부동기점으로 나뉜다

##### 주동기점
- 전송 단위가 대화로 정의됨
- 주동기점은 두 세션 프로세스 사이의 대화의 한 단위가 완료되었다는 것을 의미
- 주동기점의 이전은 이미 완벽하게 전송되었으므로 주동기점 이전의 복구 과정은 불필요하다.

##### 부동기점
- 대화 단위 내의 작은 부분에서 설정됨
- 오류 복구가 완벽하게 이루어지지 않을 가능성이 있다.
- 복구에 필요한 백업 정보량이 주동기점보다 낮아 복구 소요 부담이 덜하다.
- 부동기점에서 복구가 이루어지지 않았다면 순차적으로 전 부동기점으로 후퇴해 복구를 수행한다.

### 세션 연결
- 상위 계층의 응용프로세스가 다른 응용프로세스에 세션을 설정하기 위해 세션 계층의 연결을 사용한다.

#### 다중 세션 연결을 지원하는 서버
<p align="center"><img src="../images/multi_session.jpg" width="600"></p>

- 하나의 서버가 다수의 클라이언트를 동시에 지원할 수 있다. (각각 별도의 독립적 연결이다)
- 서버가 제공하는 서비스 시간이 짧은 응용 환경에서 유용하게 사용된다.
- 하나의 서버의 서비스 이용시간이 길어질 경우 나머지 클라이언트의 대기시간이 무한정 증가될 수 있다.

#### 단일 세션 연결을 지원하는 서버
<p align="center"><img src="../images/single_session.jpg" width="600"></p>

- 하나의 서버가 하나의 클리언트만 지원한다.
- 여러 클라이언트를 지원하려면 복사된 하위 서버를 여러 개 만들어 연결해아 한다.
- 초기 서비스 환경 구축이 필요해 서비스 시간이 짧은 응용 환경에는 사용되지 않는다.
- 대부분의 TCP/IP 서비스는 단일 세션 연결 방식을 사용하고 있다

## 3. 표현 계층
- 응용 프로세스 사이에 전송되는 메시지의 표현 방법을 규정한다

### 1) 데이터 표현
- 컴퓨터는 제각각 자신이 이해하는 방식으로 데이터를 표현할 때 추상문법을 사용하며, 문제 없이 송수신하기 위해 공통된 규칙인 전송 문법으로 변환해 전송한다.

### 2) 데이터 압축 & 보안
- 압축 : 전송 데이터 양을 줄이는 목적으로 사용
- 암호화 : 데이터를 송수신하는 당사자 외의 제 3자에게 유출되거나 왜곡되는 현상을 방지
- 데이터를 압축해 줄이는 과정에서 어떤 알고리즘을 적용하느냐에 따라 압축률이 달라진다.
  - 어떤 알고리즘을 정하기보다는 데이터의 특성에 맞는 알고리즘을 사용하는 것이 중요하다.

#### 손실, 비손실 압축
- 비손실 압축(Lossless Compression) : 압축 과정에서 원래 데이터의 내용을 분실하지 않는다.
  - 압축 해제 시 압축 이전의 데이터와 완전히 동일하다.
- 손실 압축(Lossy Compression) : 압축 과정에서 원래 데이터 일부가 손실된다.
  - 압축 해제한 데이터가 원래 데이터와 동일하지 않다. (데이터 손실정도는 응용 환경에 따라 허용범위가 다르다.)
- 손실 압축 사용 시 비손실 압축에 비해 압축 데이터 크기가 작아 데이터 전송 효율을 높일 수 있다.

## 4. 응용 계층
- 응용 계층 하부의 계층들은 신뢰성 있는 데이터 전송을 보장하는 것이다.
  - 응용 계층은 하부 계층을 이용해 사용자에게 편리한 응용 환경을 제공하는 역할을 한다.
- 응용 계층의 구현은 사용자 프로그램 환경에서 이루어진다.
- 응용 계층은 다양한 종류가 있으며 아래 내용은 TCP/IP 기반의 인터넷 환경과 유닉스 운영체제 기반으로 언급되는 서비스 관련 내용이다.

### 1) 클라이언트, 서버 모델
- 인터넷 응용 환경에서 보편화된 연결 설정방식으로 서버가 반드시 처음에 통신 대기 상태에 있어야 한다.
- 클라이언트는 서버에게 연결 요청을 시도하며 클라이언트와 서버의 네트워크 연결은 TCP/UDP 의 포트 연결로 구성된다.

### 2) 클라이언트, 서버 모델 고려사항
- 연결형 / 비연결형 서비스
- 상태(State)정보 : 특정 상황에 대하여 통신 양단이 바라보는 관점을 상태라고 말하며 상태(State) / 무상태(Stateless) 서비스가 있다. 
<p align="center"><img src="../images/application_state.png" width="800"></p>

- 동시성 제어 : 동시성 제어는 여러 동작의 선후 진행속도에 상관 없이 동시에 실행되어도 항상 같은 실행 결과를 보장한다.
